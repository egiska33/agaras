<template>
    <div id='docContainer'>
        <div id='innerDocContainer'>
            <table class="no-border table-text-left">
        		<tr height="30px">
        			<td><strong>UAB ,,Agaras", Balandiškių km., Pabiržės sen. Biržų r. LT-41385, Lietuva</strong></td>
        		</tr>
        		<tr>
        			<td><strong>Įm. kodas 154742821</strong></td>
        		</tr>
        	</table>
        	<table class="no-border">
        		<tr height="50px">
        			<td><h1>PINIGŲ IŠMOKĖJIMO KVITAS</h1></td>
        		</tr>
        		<tr height="20px">

        			<td><strong><small>Serija</small> <span class='piSeries'></span> Nr. <span class='piNo'></span></strong></td>
        		</tr>
        		<td height="30px"><span class='doc_year'></span> m. <span class='doc_month'></span> mėn. <span class='doc_day'></span> d.</td>
        	</table>
        	<table class="no-border no-collapse table-text-left">
        		<tr>
        			<td>Išmokėti už</td>
        			<td class="dot-line field_1" width="88%">gyvulius<span class='hideIfSFUndefined'> pagal SF: Serija <span class='sfSerial'></span> Nr.<span class='sfNo'></span></span></td>
        		</tr>
        		<tr>
        			<td colspan="2"	class="text-center text-below">perkamų prekių / paslaugų pavadinimai, kiekiai, matavimo vienetai, vieneto kaina</td>
        		</tr>
        		<tr>
        			<td colspan="2" class="dot-line" height="20px"></td>
        		</tr>
        		<tr>
        			<td colspan="2"	 class="text-center text-below">perkamų prekių / paslaugų pavadinimai, kiekiai, matavimo vienetai, vieneto kaina</td>
        		</tr>
        		<tr>
        			<td>Išmokėti už</td>
        			<td class="dot-line" width="88%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="dot-line" height="20px"></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Išmokėta suma</td>
        			<td class="dot-line field_6" width="84%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(už perkamas prekes išmokėta suma žodžiais)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left">
        		<tr>
        			<td class="dot-line" width="75%"></td>
        			<td class="dot-line field_2" width="10%"></td>
        			<td>Eur</td>
        			<td class="dot-line field_3" width="10%"></td>
        			<td>ct</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Išmokėjau</td>
        			<td class="dot-line field_4" width="90%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(prekes pristačiusio asmens parašas, vardas, pavardė)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Pinigus gavau</td>
        			<td class="dot-line field_5" width="85%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(asmens kodas, paso numeris ir gyvenamoji vieta nebūtina)</td>
        		</tr>
        	</table>

            <div class='piSplit'></div>

            <table class="no-border table-text-left">
        		<tr height="30px">
        			<td><strong>UAB ,,Agaras", Balandiškių km., Pabiržės sen. Biržų r. LT-41385, Lietuva</strong></td>
        		</tr>
        		<tr>
        			<td><strong>Įm. kodas 154742821</strong></td>
        		</tr>
        	</table>
        	<table class="no-border">
        		<tr height="50px">
        			<td><h1>PINIGŲ IŠMOKĖJIMO KVITAS</h1></td>
        		</tr>
        		<tr height="20px">

        			<td><strong><small>Serija</small> <span class='piSeries'></span> Nr. <span class='piNo'></span></strong></td>
        		</tr>
        		<td height="30px"><span class='doc_year'></span> m. <span class='doc_month'></span> mėn. <span class='doc_day'></span> d.</td>
        	</table>
        	<table class="no-border no-collapse table-text-left">
        		<tr>
        			<td>Išmokėti už</td>
        			<td class="dot-line field_1" width="88%">gyvulius<span class='hideIfSFUndefined'> pagal SF: Serija <span class='sfSerial'></span> Nr.<span class='sfNo'></span></span></td>
        		</tr>
        		<tr>
        			<td colspan="2"	class="text-center text-below">perkamų prekių / paslaugų pavadinimai, kiekiai, matavimo vienetai, vieneto kaina</td>
        		</tr>
        		<tr>
        			<td colspan="2" class="dot-line" height="20px"></td>
        		</tr>
        		<tr>
        			<td colspan="2"	 class="text-center text-below">perkamų prekių / paslaugų pavadinimai, kiekiai, matavimo vienetai, vieneto kaina</td>
        		</tr>
        		<tr>
        			<td>Išmokėti už</td>
        			<td class="dot-line" width="88%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="dot-line" height="20px"></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Išmokėta suma</td>
        			<td class="dot-line field_6" width="84%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(už perkamas prekes išmokėta suma žodžiais)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left">
        		<tr>
        			<td class="dot-line" width="75%"></td>
        			<td class="dot-line field_2" width="10%"></td>
        			<td>Eur</td>
        			<td class="dot-line field_3" width="10%"></td>
        			<td>ct</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Išmokėjau</td>
        			<td class="dot-line field_4" width="90%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(prekes pristačiusio asmens parašas, vardas, pavardė)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Pinigus gavau</td>
        			<td class="dot-line field_5" width="85%"></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-center text-below">(asmens kodas, paso numeris ir gyvenamoji vieta nebūtina)</td>
        		</tr>
        	</table>
        </div>
    </div>
</template>

<script>
    import mixins from "../../../mixins.js";

    export default {
        mounted: function()
        {
            var _ = this;

            _.getDocuments();
        },

        data: function()
        {
            return {
                todaySellers: [],
                totalElementsToPrint: 0,
                docImgs: [],
                pivot: {},
                doc_SF: {},
                doc_PI: {
                    animals: []
                }
            };
        },

        methods:
        {
            getDocuments: function()
            {
                var _ = this;
                var targetId = getIdFromURL();

                return offlineDB.find('docsPivot', targetId, 'pi_id').then((pivot) => {
                    _.pivot = pivot;

                    var p = 1;

                    offlineDB.find('doc_PI', targetId, 'id').then((doc_PI) => {
                        _.doc_PI = doc_PI;

                        offlineDB.find('doc_SF', _.pivot.sf_id, 'id').then((doc_SF) => {
                            _.doc_SF = doc_SF;
                            _.fillDocumentData();
                            mixins.getTotalElementsToPrint(_);
                            mixins.snapScreen(_);
                        });
                    });
                });
            },

            fillDocumentData: function()
            {
                var _ = this;
                var now = new Date();

                _.pivot.seller_name = mixins.capitalizeFirstChar(_.pivot.seller_name);
                _.pivot.user_name = mixins.capitalizeFirstChar(_.pivot.user_name);
                _.pivot.seller_representative = mixins.capitalizeFirstChar(_.pivot.seller_representative);

                $(".doc_year").text(now.getFullYear());
                $(".doc_month").text(mixins.leftPad(now.getMonth() + 1));
                $(".doc_day").text(mixins.leftPad(now.getDate()));

                $(".piSeries").text(_.doc_PI.serial);
                $(".piNo").text(_.doc_PI.no);

                if(_.doc_PI.centsAmount < 10) _.doc_PI.centsAmount = '0'+ _.doc_PI.centsAmount;

                var priceInWords = _.toWords(_.doc_PI.euroAmount) + ' ' +_.doc_PI.centsAmount+" ct";

                $(".field_6").text(priceInWords);

                $(".field_2").text(_.doc_PI.euroAmount);
                $(".field_3").text(_.doc_PI.centsAmount);

                var sfSerial = "";
                var sfNo = "";

                if((_.doc_SF) && (_.pivot.seller_pvm_code))
                {
                    sfSerial = _.doc_SF.serial_vat;
                    sfNo =_.doc_SF.no_vat;
                }
                else if(_.doc_SF)
                {
                    sfSerial = _.doc_SF.serial;
                    sfNo =_.doc_SF.no;
                }

                $(".sfNo").text(sfNo);
                $(".sfSerial").text(sfSerial);

                if((!sfSerial) && (!sfNo)) $('.hideIfSFUndefined').hide();

                $(".field_1").text(_.doc_PI.paid_for);

                $(".field_2").text(_.doc_PI.paid_sum_eur);
                $(".field_3").text(_.doc_PI.paid_sum_ct);

                $(".field_4").text(_.pivot.user_name);

                var field5Arr = [];
                if(_.pivot.seller_representative) $(".field_5").text(_.pivot.seller_representative);
            },

            toWords: function(n, isCents, custom_join_character) {
                var string = n.toString(),
                    units, tens, scales, start, end, chunks, chunksLen, chunk, ints, i, word, words, currency;

                var and = custom_join_character || '';

                /* Is number zero? */
                if (parseInt(string) === 0) {
                    return 'Nulis';
                }

                currency = [' Eur', ' Eur', ' Eur'];

                /* Array of units as words */
                units = ['', 'vienas', 'du', 'trys', 'keturi', 'penki', 'šeši', 'septyni',
                    'aštuoni', 'devyni', 'dešimt', 'vienuolika', 'dvylika', 'trylika', 'keturiolika',
                    'penkiolika', 'šešiolika', 'septyniolika', 'aštuoniolika', 'devyniolika'];

                /* Array of tens as words */
                tens = ['', '', 'dvidešimt', 'trisdešimt', 'keturiasdešimt', 'penkiasdešimt',
                    'šešiasdešimt', 'septyniasdešimt', 'aštuoniasdešimt', 'devyniasdešimt'];

                /* Array of scales as words */
                scales = ['', 'tūkstantis'];

                /* Split user arguemnt into 3 digit chunks from right to left */
                start = string.length;
                chunks = [];
                while (start > 0) {
                    end = start;
                    chunks.push(string.slice((start = Math.max(0, start - 3)), end));
                }

                /* Check if function has enough scale words to be able to stringify the user argument */
                chunksLen = chunks.length;
                if (chunksLen > scales.length) return '';

                /* Stringify each integer in each chunk */
                words = [];
                for (i = 0; i < chunksLen; i++) {
                    chunk = parseInt(chunks[i]);

                    if (chunk) {
                        /* Split chunk into array of individual integers */
                        ints = chunks[i].split('').reverse().map(parseFloat);

                        /* If tens integer is 1, i.e. 10, then add 10 to units integer */
                        if (ints[1] === 1) ints[0] += 10;

                        /* Add scale word if chunk is not zero and array item exists */
                        if ((word = scales[i]))
                        {
                            if((chunk % 10 == 0) || ((chunk >= 10) && (chunk <= 20))) words.push('tūkstančių');
                            else if(chunk % 10 == 1) words.push('tūkstantis');
                            else words.push('tūkstančiai');
                        }

                        /* Add unit word if array item exists */
                        if ((word = units[ints[0]]))
                        {
                            if(chunk == Number(chunks[0]))
                            {
                                if((chunk % 10 == 0) || ((chunk >= 10) && (chunk <= 20))) word += currency[0];
                                else if(chunk % 10 == 1) word += currency[1];
                                else word += currency[2];
                            }

                            words.push(word);
                        }

                        /* Add tens word if array item exists */
                        if ((word = tens[ints[1]])) words.push(word);

                        /* Add 'and' string after units or tens integer if: */
                        if (ints[0] || ints[1]) {
                            /* Chunk has a hundreds integer or chunk is the first of multiple chunks */
                            if (ints[2] || !i && chunksLen) words.push(and);
                        }

                        /* Add hundreds word if array item exists */
                        if ((word = units[ints[2]])) {
                            if(chunk > 199) words.push(word + ' šimtai');
                            else words.push(word + ' šimtas');
                        }
                    }
                }

                return words.reverse().join(' ').replace('  ', ' ');
            }
        }
    }
</script>
