<template>
    <div id='docContainer'>
        <div id='innerDocContainer'>
            <table class="no-border">
                <tbody>
            		<tr>
            			<td></td>
            			<td class="font-5 text-right newRoman" width="100%">
            				<span>Forma patvirtinta Valstybinės maisto ir veterinarijos tarnybos direktoriaus 2006 m. kovo 16 d. įsakymu Nr. B1-207<br />
            				(Valstybinės maisto ir veterinarijos tarnybos direktoriaus 2015 m. gegužės 19 d. įsakymo Nr. B1-433 redakcija)</span>
            			</td>
            		</tr>
                </tbody>
        	</table>
        	<table class="no-border">
        		<tr>
        			<td><h2>LIETUVOS RESPUBLIKOJE VEŽAMŲ GYVŪNŲ VAŽTARAŠTIS</h2></td>
        		</tr>
        		<tr>
        			<td><span class='doc_year'></span> m. <span class='doc_month'></span> mėn. <span class='doc_day'></span> d.</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Gyvūnų laikytojas</td>
        			<td class="solid-line field_1" width="80%"></td>
        		</tr>
        		<tr>
        			<td colspan="2"	class="text-center text-below"><span>(vardas, pavardė / įmonės pavadinimas, kodas, veterinarinio patvirtinimo Nr.*)</span></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Gyvūnų laikytojo adresas</td>
        			<td class="solid-line field_2" width="77%"></td>
        		</tr>
        		<tr>
        			<td colspan="2"	class="text-center text-below"><span>(rajonas, savivaldybė, seniūnija, vietovė, gatvė, namo numeris)</span></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left" width='100%'>
        		<tr>
        			<td width='130px'>Gyvūnų laikymo vieta</td>
        			<td class="solid-line field_3"><span class='heldNo' style='width: 50%;display:inline-block'></span><span class='bandNo' style='width: 50%;display:inline-block'></span></td>
        		</tr>
        		<tr>
        			<td colspan="2" class="text-right">
        				<span class="text-below margin-right"><span>(laikymo vietos numeris*)</span></span>
        				<span class="text-below margin-right"><span>(bandos numeris*)</span></span>
        			</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left" width='100%'>
        		<tr>
        			<td width='200px'>Gyvūnų laikymo vietos adresas**</td>
        			<td class="solid-line field_4"></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Gyvūnų vežėjas: UAB &quot;Agaras&quot;, 154742821, 36-LT90-402.</td>
        			<td class="solid-line field_5" width="55%"></td>
        		</tr>
        		<tr>
        			<td></td>
        			<td class="text-center text-below">(valst. nr., priekabos nr.)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Paskirties vieta: UAB &quot;Agaras&quot;, Agaro g. 5, Balandiškių k. Pabiržės sen., Biržų r. LT-41385, Lietuva.</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Planuojama kelionė trukmė (val.):</td>
        			<td class="solid-line field_6" width="16%"></td>
        			<td>Išvykimo data ir laikas:</td>
        			<td class="solid-line field_7" width="32%"></td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Planuojama atvykimo į paskirties vietą data ir laikas:</td>
        			<td class="solid-line field_8" width="32%"></td>
        			<td>Gyvūnų rūšis</td>
        			<td class="solid-line field_9" width="15%">Galvijai</td>
        		</tr>
        	</table>
        	<table class="no-outer-border margin-10 hugeTable">
                <thead>
            		<tr>
            			<td rowspan="2">Eil. Nr.</td>
            			<td colspan="6">Gyvūno</td>
            		</tr>
            		<tr>
            			<td>individualaus ženklinimo<br /> Nr.*/bandos Nr.*</td>
            			<td>paso Nr.*</td>
            			<td>lytis</td>
            			<td>veislė</td>
            			<td>gimimo šalis, data</td>
            			<td>užauginimo vieta<br /> (nurodyti šalies pavadinimą)***</td>
            		</tr>
                </thead>
                <tbody class='animalsTbody'></tbody>
        	</table>
        	<p class="no-margin">
        		Gyvunų skaičius/kiekis <span class='totalAnimals' ></span> vnt. / <span class='totalAnimalWeight'></span> kg
        	</p>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Aš,</td>
        			<td class="solid-line field_10" width="45%"></td>
        			<td width="55%">, p a t v i r t i n u, kad:</td>
        		</tr>
        		<tr>
        			<td></td>
        			<td class="text-center text-below"><span>(gyvūnų laikytojo vardas, pavardė / įmonei atstovaujančio asmens vardas ir pavardė)</span></td>
        			<td></td>
        		</tr>
        	</table>
            <ol><li>1. Gyvūnų laikymo vietoje išvežamiems gyvūnams netaikomi / <span class='crossout'>taikomi</span> (nereikalingą žodį išbraukti) pagal
                    <span></span>
                    apribojimai dėl gyvūnų užkrečiamųjų ligų;</li></ol>
            <ol><li>2. Arklinių šeimos gyvūnai neturėjo sąlyčio su arklinių šeimos gyvūnais, sergančiais užkrečiamąja liga, ne mažiau kaip 15 d.;</li></ol>
            <ol><li>3. Arklinių šeimos gyvūnai nebuvo / buvo (nereikalingą žodį išbraukti) gydomi paskutinius 6 mėnesius vadovaujantis 2006 m. gruodžio
                    13 d. Komisijos reglamentu (EB) Nr. 1950/2006, nustatančiu arklinių šeimos gyvūnams gydyti būtinų medžiagų sąrašą pagal Europos Parlamento ir
                    Tarybos direktyvą 2001/82/EB dėl Bendrijos kodekso, reglamentuojančio veterinarinius vaistus (OL 2006 L 367, p. 33), su paskutiniais pakeitimais,
                    padarytais 2013 m. vasario 12 d. Komisijos reglamentu (ES) Nr. 122/2013 (OL 2013 L 42, p. 1);</li></ol>
            <ol><li>4. Gyvūnams nebuvo naudojami augimo stimuliatoriai;</li></ol>
            <ol><li>5. Paskutinius 2 mėnesius gyvūnams gydyti buvo naudojamas (-ami) veterinarinis (-iai) vaistas (-ai)
                    <span class="solid-line" style="width: 45%; height: 13px; display: inline-block;">nenaudoti</span>
                    , kurio (-ių) išlauka pasibaigė <span class="solid-line" style="width: 30%; height: 10px; display: inline-block;"></span></li></ol>
            <ol><li>6. Minėti gyvūnai tinkami vežti nustatytu maršrutu laikantis 2004 m. gruodžio 22 d. Tarybos reglamento (EB) Nr. 1/2005 dėl gyvūnų
                    apsaugos juos vežant ir atliekant susijusias operacijas, ir iš dalies keičiančio direktyvas 64/432/EEB ir 93/119/EB ir reglamentą (EB) Nr. 1255/97 (OL
                    2005 L 3, p. 1), reikalavimų.</li></ol>
            <ol><li>7. Šis važtaraštis surašytas 2 (dviem) egzemplioriais, iš kurių vienas duodamas gyvūnų laikytojui, kitas – transporto priemonės vairuotojui,
                    kuris jį palieka paskirties vietoje.</li></ol>
            <table class="no-border no-collapse table-text-left">
        		<tr>
        			<td>Gyvūnų laikytojas / įmonei atstovaujantis asmuo</td>
        			<td class="solid-line field_11" width="60%"></td>
        		</tr>
        		<tr>
        			<td></td>
        			<td class="text-center text-below">(parašas, vardas, pavardė)</td>
        		</tr>
        	</table>
        	<table class="no-border no-collapse table-text-left margin-10">
        		<tr>
        			<td>Transporto priemonės vairuotojas</td>
        			<td class="solid-line field_12" width="70%"></td>
        		</tr>
        		<tr>
        			<td></td>
        			<td class="text-center text-below">(parašas, vardas, pavardė)</td>
        		</tr>
        	</table>
            <p >* – jei suteiktas;</p>
            <p >** – nurodoma, jei gyvūnų laikymo vieta nėra registruota Ūkinių gyvūnų registre;</p>
            <p >
                *** – nurodoma tik vežant kiaules, avis, ožkas ir naminius paukščius. Gyvūno užauginimo vieta nurodoma vadovaujantis 2013 m. gruodžio 13 d. Komisijos įgyvendinimo reglamento (ES) Nr. 1337/2013,
                kuriuo nustatomos Europos Parlamento ir Tarybos reglamento (ES) Nr. 1169/2011 taikymo taisyklės, susijusios su šviežios, atšaldytos ir užšaldytos kiaulienos, avienos, ožkienos ir paukštienos kilmės
                šalies arba kilmės vietos nuorodomis (OL 2013 L 335, p. 19), 5 straipsniu
            </p>
        </div>
    </div>
</template>

<script>
    import mixins from "../../../mixins.js";

    export default {
        mounted: function()
        {
            var _ = this;

            _.getDocuments();
        },

        data: function()
        {
            return {
                todaySellers: [],
                totalElementsToPrint: 0,
                docImgs: [],
                pivot: {},
                doc_VG: {
                    animals: []
                }
            };
        },

        methods:
        {
            getDocuments: function()
            {
                var _ = this;
                var targetId = getIdFromURL();

                return offlineDB.find('docsPivot', targetId, 'vg_id').then((pivot) => {
                    _.pivot = pivot;

                    var p = 1;
                    let totalAnimalsWeight = 0;

                    offlineDB.get('animals', (cursor) => {
                        if(cursor.value.seller_code == pivot.seller_code)
                        {
                            let sexMapper = {
                                'Bulius iki 24mėn.': 'A',
                                'Bulius virš 24mėn': 'B',
                                'Kastratas': 'C',
                                'Karvė': 'D',
                                'Telyčia': 'E',
                                'Telyčaitė': 'E'
                            };

                            var currAnimal = cursor.value;

                            totalAnimalsWeight += Number(currAnimal.real_weight);
                            var row = $("<tr>");
                            row.append("<td>"+p+"</td>");
                            row.append("<td>"+sexMapper[currAnimal.specie]+"-"+currAnimal.animal_id+"</td>");
                            row.append("<td>"+currAnimal.passport_id+"</td>");
                            row.append("<td>"+currAnimal.specie+"</td>");
                            row.append("<td>"+currAnimal.breed+"</td>");
                            row.append("<td>"+currAnimal.cob+", "+currAnimal.dob+"</td>");
                            row.append("<td>"+currAnimal.pog+"</td>");
                            $(".animalsTbody").append(row);
                            p++;
                        }
                    }).then(() => {
                        $(".totalAnimalWeight").text(totalAnimalsWeight);
                        $(".totalAnimals").text(--p);
                        _.fillDocumentData();
                        mixins.getTotalElementsToPrint(_);
                        mixins.snapScreen(_);
                    });

                    offlineDB.find('doc_VG', targetId, 'id').then((doc_VG) => {
                        _.doc_VG = doc_VG;
                    });
                });
            },

            fillDocumentData: function()
            {
                var _ = this;
                var now = new Date();

                $(".doc_year").text(now.getFullYear());
                $(".doc_month").text(mixins.leftPad(now.getMonth() + 1));
                $(".doc_day").text(mixins.leftPad(now.getDate()));

                _.pivot.seller_name = mixins.capitalizeFirstChar(_.pivot.seller_name);
                _.pivot.user_name = mixins.capitalizeFirstChar(_.pivot.user_name);
                _.pivot.seller_representative = mixins.capitalizeFirstChar(_.pivot.seller_representative);

                var field1Arr = [];
                if(_.pivot.seller_name) field1Arr.push(_.pivot.seller_name);
                if(_.pivot.seller_code) field1Arr.push(_.pivot.seller_code);
                if(_.doc_VG.vet_pass_number) field1Arr.push(_.doc_VG.vet_pass_number);
                $(".field_1").text(field1Arr.join(', '));

                var field2Arr = [];
                if(_.pivot.seller_address) field2Arr.push(_.pivot.seller_address);
                if(_.pivot.seller_post_code) field2Arr.push(_.pivot.seller_post_code);
                $(".field_2").text(field2Arr.join(', '));

                if(_.pivot.animal_herd_number) $('.bandNo').text(_.pivot.animal_herd_number);
                if(_.pivot.animal_place_number) $('.heldNo').text(_.pivot.animal_place_number);

                $(".field_4").text(_.pivot.seller_pick_up_address);

                var field5Arr = [];
                if(_.pivot.user_plate) field5Arr.push(_.pivot.user_plate);
                if(_.pivot.user_trailer_plates) field5Arr.push(_.pivot.user_trailer_plates.toUpperCase());
                $(".field_5").text(field5Arr.join(', '));

                $(".field_6").text(_.pivot.travel_duration);

                var addMinutes = (date, minutes) => {
                    return new Date(date.getTime() + minutes*60000);
                }

                now = addMinutes(now, 30);

                var year = now.getFullYear();
                var month = mixins.leftPad(now.getMonth() + 1);
                var day = mixins.leftPad(now.getDate());

                if(Number(_.pivot.travel_start_hour) < 10) _.pivot.travel_start_hour = '0'+Number(_.pivot.travel_start_hour);
                if(Number(_.pivot.travel_start_minute) < 10) _.pivot.travel_start_minute = '0'+Number(_.pivot.travel_start_minute);

                if(Number(_.pivot.travel_arrive_hour) < 10) _.pivot.travel_arrive_hour = '0'+Number(_.pivot.travel_arrive_hour);
                if(Number(_.pivot.travel_arrive_minute) < 10) _.pivot.travel_arrive_minute = '0'+Number(_.pivot.travel_arrive_minute);

                if(!_.pivot.travel_start_date) _.pivot.travel_start_date = year+'-'+month+'-'+day;
                if(!_.pivot.travel_start_hour) _.pivot.travel_start_hour = mixins.leftPad(now.getHours());
                if(!_.pivot.travel_start_minute) _.pivot.travel_start_minute = mixins.leftPad(now.getMinutes());
                $(".field_7").text(_.pivot.travel_start_date+' '+_.pivot.travel_start_hour+":"+_.pivot.travel_start_minute);

                var arriveDateTime = _.pivot.travel_arrive_date;
                if((_.pivot.travel_arrive_date) && (_.pivot.travel_arrive_hour) && (_.pivot.travel_arrive_minute)) arriveDateTime = _.pivot.travel_arrive_date+' '+_.pivot.travel_arrive_hour+":"+_.pivot.travel_arrive_minute;
                if(!arriveDateTime) arriveDateTime = '';
                $(".field_8").text(arriveDateTime);

                $(".field_10").text(_.pivot.seller_representative);
                $(".field_11").text(_.pivot.seller_representative);
                $(".field_12").text(_.pivot.user_name);
            }
        }
    }
</script>
